# Contributing to Provisioning

## Basic guidelines for code contributions

Here are few points before you start contributing:

* Binaries go into the `cmd/name` package.
* All code go into the `internal/` package.
* Binaries must not take any arguments.
* All configuration is done via `configs/local.yml` and can be overseeded by environment variables.
* Database models (structs) do belong into `internal/models`.
* Do not put any code logic into database models.
* All database operations (CRUD, eager loading) lives in `internal/dao` (Data Access Objects) with a common API interface.
* The actual implementation lives in `internal/dao/sqlx` package, all operations are passed with Context and errors are wrapped.
* Database models must be not exposed directly into JSON API, use `internal/payloads` package to wrap them.
* Business logic (the actual code) does belong into `internal/services` package, each API call should have a dedicated file.
* HTTP routes go into `internal/routes` package.
* HTTP middleware go into `internal/middleware` package.
* Monitoring metrics are in `internal/metrics` package.
* Use the standard library context package for context operations. Context keys are defined in `internal/ctxval` as well as accessor functions.
* Database connection is at `internal/db`, HTTP service clients are in `internal/clients`.
* Do not introduce `utils` or `tools` common packages.
* Keep the line of sight (happy code path).
* PostgreSQL version we currently use in production is v14+ so take advantage of all modern SQL features.
* Use `BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY` for primary keys. This allows us to use 1-100 in our seed data (see above).
* Use `TEXT` for string columns, do not apply any limits in the DB: https://wiki.postgresql.org/wiki/Don%27t_Do_This#Text_storage
* When modifying the API endpoints or types, please [update](https://github.com/RHEnVision/provisioning-backend/blob/main/docs/openapi.md) the openapi spec file as well

Keep security in mind: https://github.com/RedHatInsights/secure-coding-checklist

## Testing

All code logic has unit test coverage.
We test all logic in isolation
